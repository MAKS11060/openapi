import*as e from"@asyncapi/react-component/lib/esm/without-parser.js";import*as r from"react";import*as s from"react/jsx-runtime.js";import*as t from"short-unique-id";import*as a from"@asyncapi/parser";import*as o from"@asyncapi/openapi-schema-parser";import*as n from"@asyncapi/avro-schema-parser";import*as c from"@asyncapi/protobuf-schema-parser";import*as i from"js-yaml";import*as p from"immutable";import*as d from"reselect";var l={480:r=>{r.exports=e}},u={};function m(e){var r=u[e];if(void 0!==r)return r.exports;var s=u[e]={exports:{}};return l[e](s,s.exports,m),s.exports}m.d=(e,r)=>{for(var s in r)m.o(r,s)&&!m.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:r[s]})},m.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var P={};(()=>{m.d(P,{Z:()=>re});const e=(e=>{var r={};return m.d(r,e),r})({Suspense:()=>r.Suspense,default:()=>r.default,useEffect:()=>r.useEffect,useMemo:()=>r.useMemo});const l=(e=>{var r={};return m.d(r,e),r})({jsx:()=>s.jsx,jsxs:()=>s.jsxs}),u=()=>(0,l.jsx)("div",{children:"Loading..."}),y=()=>(0,l.jsx)("div",{children:"Parsing..."}),v=({getComponent:r,editorPreviewAsyncAPIActions:s,editorPreviewAsyncAPISelectors:t})=>{const a=r("EditorPreviewAsyncAPIParseErrors"),o=r("EditorPreviewAsyncAPIReactComponent"),n=t.selectIsParseInProgress(),c=t.selectIsParseSuccess(),i=t.selectIsParseFailure(),p=t.selectParseResult(),d=t.selectParseErrors(),m=(0,e.useMemo)((()=>({show:{errors:!0}})),[]);return(0,e.useEffect)((()=>()=>{s.previewUnmounted()}),[s]),(0,l.jsx)("div",{className:"swagger-editor__editor-preview-asyncapi",children:(0,l.jsxs)(e.Suspense,{fallback:(0,l.jsx)(u,{}),children:[n&&(0,l.jsx)(y,{}),c&&(0,l.jsx)(o,{schema:p,config:m}),i&&(0,l.jsx)(a,{errors:d})]})})},I=e.default.lazy((()=>Promise.resolve().then(m.bind(m,480)))),f=()=>(0,l.jsx)("div",{className:"swagger-editor__editor-preview-asyncapi-parse-errors",children:(0,l.jsx)("div",{className:"swagger-ui",children:(0,l.jsx)("div",{className:"version-pragma",children:(0,l.jsx)("div",{className:"version-pragma__message version-pragma__message--missing",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{children:"Invalid AsyncAPI definition."}),(0,l.jsx)("p",{children:"The provided AsyncAPI definition is not valid. Please check your syntax, and correct any discrepancies to ensure it adheres to the AsyncAPI standards."})]})})})})}),h=(e,r)=>({getComponent:s,editorSelectors:t})=>{const a=s("EditorPreviewAsyncAPI",!0);return t.selectIsContentTypeAsyncAPI()?(0,l.jsx)(a,{}):(0,l.jsx)(e,{...r})};const g=(e=>{var r={};return m.d(r,e),r})({default:()=>t.default});const A=(e=>{var r={};return m.d(r,e),r})({Parser:()=>a.Parser});const S=(e=>{var r={};return m.d(r,e),r})({OpenAPISchemaParser:()=>o.OpenAPISchemaParser});const w=(e=>{var r={};return m.d(r,e),r})({AvroSchemaParser:()=>n.AvroSchemaParser});const x=(e=>{var r={};return m.d(r,e),r})({ProtoBuffSchemaParser:()=>c.ProtoBuffSchemaParser});const j=(e=>{var r={};return m.d(r,e),r})({default:()=>i.default}),R="editor_preview_asyncapi_preview_unmounted",E="editor_preview_asyncapi_parse_started",_="editor_preview_asyncapi_parse_success",q="editor_preview_asyncapi_parse_failure",b=()=>({type:R}),C=({content:e,requestId:r})=>({type:E,payload:e,meta:{requestId:r}}),M=({parseResult:e,content:r,requestId:s})=>({type:_,payload:e,meta:{content:r,requestId:s}}),O=({error:e,parseResult:r,content:s,requestId:t})=>({type:q,payload:e,error:!0,meta:{content:s,requestId:t,parseResult:r}}),k=(e,r={})=>{const s=new g.default({length:10}),{parserOptions:t,parseOptions:a}=r,o=[(0,S.OpenAPISchemaParser)(),(0,w.AvroSchemaParser)(),{validate:async()=>[],async parse({message:e,defaultSchemaFormat:r}){try{let{payload:s}=e;"object"===typeof s&&(s=j.default.dump(s)),e["x-parser-original-schema-format"]=e.schemaFormat||r,e["x-parser-original-payload"]=s,e.payload={description:`\`\`\`raml\n${s}\n\`\`\``}}catch(s){console.error(s)}},getMimeTypes:()=>["application/raml+yaml;version=1.0"]},(0,x.ProtoBuffSchemaParser)()],n=new A.Parser({schemaParsers:o,...null!==t&&void 0!==t?t:r});return async t=>{const{editorPreviewAsyncAPIActions:o}=t,c=s();o.parseStarted({content:e,requestId:c});try{const s=await n.parse(e,null!==a&&void 0!==a?a:r);s.document?o.parseSuccess({parseResult:s,content:e,requestId:c}):o.parseFailure({error:new Error("Document is empty"),parseResult:s,content:e,requestId:c})}catch(i){o.parseFailure({error:i,content:e,requestId:c})}}},N=(e=>{let r=null;return(s,t)=>(...a)=>{const o=s(...a);return o===r||(e(s,t)(...a),r=o),o}})(((e,r)=>({content:e})=>{const{editorSelectors:s,editorPreviewAsyncAPIActions:t}=r;s.selectIsContentTypeAsyncAPI()&&t.parse(e)}));const D=(e=>{var r={};return m.d(r,e),r})({fromJS:()=>p.fromJS}),F="idle",T="parsing",V="success",J="failure",L={parseStatus:F,parseRequestId:null,parseResult:null,parseErrors:null},B={[R]:e=>{const{parseStatus:r,parseRequestId:s,parseResult:t,parseErrors:a}=L;return e.merge({parseStatus:r,parseRequestId:s,parseResult:t,parseErrors:a})},[E]:(e,r)=>e.merge({parseStatus:T,parseRequestId:r.meta.requestId}),[_]:(e,r)=>{const s=e.get("parseStatus")||F,t=e.get("parseRequestId");return s===T&&t===r.meta.requestId?e.merge({parseStatus:V,parseRequestId:null,parseResult:r.payload.document,parseErrors:null}):e},[q]:(e,r)=>{const s=e.get("parseStatus")||F,t=e.get("parseRequestId");return s===T&&t===r.meta.requestId?e.merge({parseStatus:J,parseRequestId:null,parseResult:null,parseErrors:(0,D.fromJS)(r.meta.parseResult.diagnostics.filter((e=>0===e.severity)))}):e}};const U=(e=>{var r={};return m.d(r,e),r})({createSelector:()=>d.createSelector}),Z=e=>e,z=e=>e.get("parseStatus",F),W=(0,U.createSelector)(Z,(e=>e.get("parseResult",L.parseResult))),$=(0,U.createSelector)(Z,(e=>{const r=e.get("parseErrors",L.parseErrors);return null===r?[]:r.toJS()})),G=(0,U.createSelector)($,((e,{monaco:r})=>r),((e,{modelVersionId:r})=>r),((e,r,s)=>e.map((e=>({message:e.message,startLineNumber:e.range.start.line,endLineNumber:e.range.end.line,startColumn:e.range.start.character,endColumn:e.range.end.character,code:"ASNCPRSR",severity:r.MarkerSeverity.Error,source:"@asyncapi/parser",modelVersionId:s}))))),H=(0,U.createSelector)(z,W,$,((e,r,s)=>e===T&&null===r&&null===s)),K=(0,U.createSelector)(z,(e=>e===V)),Q=(0,U.createSelector)(z,(e=>e===J));class X extends Array{dispose(){this.forEach((e=>e.dispose())),this.length=0}}const Y=({system:e})=>{const{fn:r,editorPreviewAsyncAPISelectors:s,editorSelectors:t,monaco:a}=e,o=new X;return o.push(r.registerMarkerDataProvider("apidom",{owner:"asyncapi-parser",async provideMarkerData(e){const o=e.getValue(),n=e.getVersionId(),c=()=>t.selectIsContentTypeAsyncAPI()&&o===t.selectContent()&&!s.selectIsParseInProgress();try{return await r.waitUntil(c),s.selectIsParseSuccess()?[]:s.selectParseMarkers({monaco:a,modelVersionId:n})}catch(i){return[]}}})),o.push(a.editor.onDidCreateEditor((e=>{o.push(e.onDidDispose((()=>{o.forEach((e=>{e.dispose()})),o.length=0})))}))),o};const ee=function(e){const{monaco:r,fn:s}=e,t="undefined"!==typeof r,a="undefined"!==typeof s.getApiDOMWorker,o=this.statePlugins.editorPreviewAsyncAPI;t&&a&&(o.disposables&&o.disposables.dispose(),o.disposables=Y({system:e}))},re=()=>({afterLoad:ee,components:{EditorPreviewAsyncAPI:v,EditorPreviewAsyncAPIParseErrors:f,EditorPreviewAsyncAPIReactComponent:I},wrapComponents:{EditorPreview:h},statePlugins:{editor:{wrapActions:{detectContentTypeSuccess:N}},editorPreviewAsyncAPI:{actions:{previewUnmounted:b,parse:k,parseStarted:C,parseSuccess:M,parseFailure:O},selectors:{selectParseStatus:z,selectIsParseInProgress:H,selectIsParseSuccess:K,selectIsParseFailure:Q,selectParseResult:W,selectParseErrors:$,selectParseMarkers:G},reducers:B}}})})();var y=P.Z;export{y as default};
//# sourceMappingURL=index.js.map