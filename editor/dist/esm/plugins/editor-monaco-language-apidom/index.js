import*as e from"monaco-editor";import*as t from"vscode";import*as o from"vscode/vscode/vs/editor/common/languages/modesRegistry";import*as r from"vscode-languageclient/lib/common/codeConverter.js";import*as n from"vscode-languageclient/lib/common/protocolConverter.js";import*as i from"js-yaml";var s={d:(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},a={};function c(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}s.d(a,{Z:()=>Te});var u=0;function d(e){return"__private_"+u+++"_"+e}const l=(e=>{var t={};return s.d(t,e),t})({editor:()=>e.editor,languages:()=>e.languages});const g=(e=>{var t={};return s.d(t,e),t})({languages:()=>t.languages});const p=(e=>{var t={};return s.d(t,e),t})({ModesRegistry:()=>o.ModesRegistry}),h="apidom",v={comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],onEnterRules:[{beforeText:/:\s*$/,action:{indentAction:l.languages.IndentAction.Indent}},{beforeText:/-\s+\w*$/,action:{indentAction:l.languages.IndentAction.None,appendText:"- "}},{beforeText:/-\s*$/,action:{indentAction:l.languages.IndentAction.None,appendText:"- "}}]},f={defaultToken:"invalid",keywords:["swagger","info","host","basePath","tags","schemes","paths","externalDocs"],typeKeywords:["description","title","termsOfService"],escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/[a-zA-Z_$][\w$]*/,{cases:{"@keywords":{token:"keyword"},"@typeKeywords":{token:"type"},"@default":"identifier"}}],{include:"@whitespace"},[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string"]],whitespace:[[/[ \t\r\n]+/,""]],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]]}};const m=(e=>{var t={};return s.d(t,e),t})({createConverter:()=>r.createConverter});const y=(e=>{var t={};return s.d(t,e),t})({createConverter:()=>n.createConverter});var w=d("defaults"),P=d("worker"),b=d("client"),C=d("idleCheckInterval"),k=d("lastUsedTime"),O=d("stopWorker"),D=d("checkIfIdle"),S=d("getClient");class j{constructor(e){Object.defineProperty(this,S,{value:_}),Object.defineProperty(this,D,{value:L}),Object.defineProperty(this,O,{value:I}),Object.defineProperty(this,w,{writable:!0,value:null}),Object.defineProperty(this,P,{writable:!0,value:null}),Object.defineProperty(this,b,{writable:!0,value:null}),Object.defineProperty(this,C,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:0}),c(this,w)[w]=e,c(this,C)[C]=setInterval((()=>c(this,D)[D]()),3e4)}async getLanguageServiceWorker(...e){const t=await c(this,S)[S]();return await c(this,P)[P].withSyncedResources(e),t}dispose(){clearInterval(c(this,C)[C]),c(this,O)[O]()}}function I(){c(this,P)[P]&&(c(this,P)[P].dispose(),c(this,P)[P]=null),c(this,b)[b]=null}function L(){if(!c(this,P)[P])return;Date.now()-c(this,k)[k]>12e4&&c(this,O)[O]()}async function _(){return c(this,k)[k]=Date.now(),c(this,b)[b]||(c(this,P)[P]=l.editor.createWebWorker({moduleId:"ApiDOMWorker",label:c(this,w)[w].getLanguageId(),createData:{...c(this,w)[w].getWorkerOptions().data,languageId:c(this,w)[w].getLanguageId(),apiDOMContext:c(this,w)[w].getWorkerOptions().apiDOMContext,customWorkerPath:c(this,w)[w].getWorkerOptions().customWorkerPath}}),c(this,b)[b]=c(this,P)[P].getProxy()),c(this,b)[b]}var A=d("worker"),M=d("codeConverter"),T=d("protocolConverter");const x=class{constructor(e,t,o){Object.defineProperty(this,A,{writable:!0,value:void 0}),Object.defineProperty(this,M,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),c(this,A)[A]=e,c(this,M)[M]=t,c(this,T)[T]=o}get worker(){return c(this,A)[A]}get codeConverter(){return c(this,M)[M]}get protocolConverter(){return c(this,T)[T]}dispose(){c(this,A)[A]=null,c(this,M)[M]=null,c(this,T)[T]=null}};var W=d("listener"),R=d("disposables"),J=d("diagnosticCollection"),E=d("system"),U=d("getDiagnostics"),N=d("validate");async function F(e){const t=await this.worker(e.uri);if(e.isDisposed())return[];try{return await t.doValidation(e.uri.toString())}catch{return[]}}async function z(e){var t;const o=await c(this,U)[U](e);null===(t=c(this,J)[J])||void 0===t||t.set(e.uri,await this.protocolConverter.asDiagnostics(o))}const $=class extends x{constructor(e,t,o,r){super(e,t,o),Object.defineProperty(this,N,{value:z}),Object.defineProperty(this,U,{value:F}),Object.defineProperty(this,W,{writable:!0,value:[]}),Object.defineProperty(this,R,{writable:!0,value:[]}),Object.defineProperty(this,J,{writable:!0,value:null}),Object.defineProperty(this,E,{writable:!0,value:null}),c(this,E)[E]=r();const n=e=>{if(e.getLanguageId()!==h)return;let t;const o=e.onDidChangeContent((()=>{clearTimeout(t),t=setTimeout((()=>c(this,N)[N](e)),300)}));c(this,W)[W][e.uri.toString()]={dispose(){o.dispose(),clearTimeout(t)}},c(this,N)[N](e)},i=e=>{c(this,J)[J].set(e.uri,[]);const t=e.uri.toString();c(this,W)[W][t]&&(c(this,W)[W][t].dispose(),delete c(this,W)[W][t])},s=()=>(c(this,J)[J]=g.languages.createDiagnosticCollection(h),c(this,J)[J]);c(this,R)[R].push(l.editor.onDidCreateModel(n)),c(this,R)[R].push(l.editor.onDidChangeModelLanguage((e=>{const t=e.uri.toString(),o=e.getLanguageId()===h,r=!!c(this,W)[W][t];!r&&o?n(e):r&&!o&&i(e)}))),c(this,R)[R].push(l.editor.onWillDisposeModel(i)),c(this,E)[E].monacoInitializationDeferred().promise.then((()=>{c(this,R)[R].push(s())}))}dispose(){super.dispose(),c(this,R)[R].forEach((e=>null===e||void 0===e?void 0:e.dispose())),c(this,R)[R]=[],c(this,E)[E]=null}};var H=d("getHover");async function Z(e,t){const o=await this.worker(e.uri);try{return await o.doHover(e.uri.toString(),this.codeConverter.asPosition(t))}catch{return}}const K=class extends x{constructor(...e){super(...e),Object.defineProperty(this,H,{value:Z})}async provideHover(e,t){const o=await c(this,H)[H](e,t);return this.protocolConverter.asHover(o)}};var V=d("getLinks");async function Y(e){const t=await this.worker(e.uri);try{return await t.doLinks(e.uri.toString())}catch{return}}const q=class extends x{constructor(...e){super(...e),Object.defineProperty(this,V,{value:Y})}async provideDocumentLinks(e){const t=(await c(this,V)[V](e)).filter((e=>!this.protocolConverter.asRange(e.range).isEmpty));return this.protocolConverter.asDocumentLinks(t)}async resolveDocumentLink(e){return e}};var B=d("getCompletionList");async function G(e,t){const o=await this.worker(e.uri);try{return await o.doComplete(e.uri.toString(),this.codeConverter.asPosition(t))}catch{return}}const Q=class extends x{constructor(...e){super(...e),Object.defineProperty(this,B,{value:G})}async provideCompletionItems(e,t){const o=await c(this,B)[B](e,t);return this.protocolConverter.asCompletionResult(o)}};var X=d("getSemanticTokens");async function ee(e){const t=await this.worker(e.uri);try{return await t.findSemanticTokens(e.uri.toString())}catch{return}}const te=class extends x{constructor(...e){super(...e),Object.defineProperty(this,X,{value:ee})}async provideDocumentSemanticTokens(e){const t=await c(this,X)[X](e);return this.protocolConverter.asSemanticTokens(t)}};var oe=d("getCodeActionList"),re=d("maybeConvert");async function ne(e,t){const o=await this.worker(e.uri);try{return await o.doCodeActions(e.uri.toString(),t)}catch{return}}function ie(e){return"undefined"===typeof e?e:this.protocolConverter.asCodeActionResult(e)}const se=class extends x{constructor(...e){super(...e),Object.defineProperty(this,re,{value:ie}),Object.defineProperty(this,oe,{value:ne})}async provideCodeActions(e,t,o){const r=await this.codeConverter.asDiagnostics(o.diagnostics),n=await c(this,oe)[oe](e,r);return c(this,re)[re](n)}};var ae=d("getSymbolInformationList");async function ce(e){const t=await this.worker(e.uri);try{return await t.findDocumentSymbols(e.uri.toString())}catch{return}}const ue=class extends x{constructor(...e){super(...e),Object.defineProperty(this,ae,{value:ce})}async provideDocumentSymbols(e){const t=await c(this,ae)[ae](e);return this.protocolConverter.asSymbolInformations(t)}};var de=d("getLocation");async function le(e,t){const o=await this.worker(e.uri);try{return await o.provideDefinition(e.uri.toString(),this.codeConverter.asPosition(t))}catch{return}}const ge=class extends x{constructor(...e){super(...e),Object.defineProperty(this,de,{value:le})}async provideDefinition(e,t){const o=await c(this,de)[de](e,t);return this.protocolConverter.asDefinitionResult(o)}};let pe;const he=e=>{for(;e.length;)e.pop().dispose()},ve=e=>({dispose:()=>he(e)}),fe=()=>{if(!pe)throw new Error("ApiDOM not registered");return pe};function me(e){const t=[],o=(0,m.createConverter)(),r=(0,y.createConverter)(void 0,!0,!0),n=new j(e),i=async(...e)=>n.getLanguageServiceWorker(...e);return pe=i,t.push({dispose(){pe=null}}),t.push(n),t.push(ve((({languageId:e,providers:t,dependencies:o})=>{he(t);const{worker:r,codeConverter:n,protocolConverter:i,getSystem:s}=o,a=[r,n,i],c=s();return t.push(new $(...a,s)),(async()=>{await c.monacoInitializationDeferred().promise,t.push(g.languages.registerHoverProvider(e,new K(...a))),t.push(g.languages.registerDocumentLinkProvider(e,new q(...a))),t.push(g.languages.registerCompletionItemProvider(e,new Q(...a))),t.push(g.languages.registerCodeActionsProvider(e,new se(...a))),t.push(g.languages.registerDocumentSymbolProvider(e,new ue(...a))),t.push(g.languages.registerDefinitionProvider(e,new ge(...a)));const o=await r(),n=await o.getSemanticTokensLegend();t.push(g.languages.registerDocumentSemanticTokensProvider(e,new te(...a),n))})(),c.monacoInitializationDeferred().promise.then((()=>{})),t})({languageId:e.getLanguageId(),providers:[],dependencies:{worker:i,codeConverter:o,protocolConverter:r,getSystem:e.getModeConfiguration().getSystem}}))),ve(t)}const ye=(e=>{var t={};return s.d(t,e),t})({default:()=>i.default}),we=({getSystem:e})=>({id:"swagger.editor.apidomDereference",label:"Resolve document",async run(t){const o=e(),r=o.editorSelectors.selectIsContentFormatJSON(),n=o.editorSelectors.selectIsContentFormatYAML();if(!r&&!n)return;const i=t.getModel(),s=await fe()(i.uri),a=await s.doDeref(i.uri.toString(),{baseURI:globalThis.document.baseURI||globalThis.location.href,format:r?0:n?1:"unknown"});if(n){const e=ye.default.dump(ye.default.load(a));o.editorActions.setContent(e)}else r&&o.editorActions.setContent(a)}}),Pe={},be={customWorkerPath:void 0,data:{}};var Ce=d("languageId"),ke=d("workerOptions"),Oe=d("modeConfiguration");class De{constructor(e,t){Object.defineProperty(this,Ce,{writable:!0,value:void 0}),Object.defineProperty(this,ke,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),this.setLanguageId(h),this.setWorkerOptions(e),this.setModeConfiguration(t)}getLanguageId(){return c(this,Ce)[Ce]}setLanguageId(e){c(this,Ce)[Ce]=e}getWorkerOptions(){return c(this,ke)[ke]}setWorkerOptions(e){c(this,ke)[ke]=e||JSON.parse(JSON.stringify(be))}getModeConfiguration(){return c(this,Oe)[Oe]}setModeConfiguration(e){c(this,Oe)[Oe]=e||JSON.parse(JSON.stringify(Pe))}}const Se=new De(be,Pe),je=({createData:e,system:t})=>{const o=[];o.push(p.ModesRegistry.registerLanguage({id:h})),t.monacoInitializationDeferred().promise.then((()=>{o.push(g.languages.setLanguageConfiguration(h,v))})),o.push(l.languages.setMonarchTokensProvider(h,f)),o.push(l.editor.onDidCreateEditor((()=>{const{customApiDOMWorkerPath:r,apiDOMContext:n,...i}=e,s=new De({apiDOMContext:n,customWorkerPath:r,data:i},{getSystem:t.getSystem});o.push(me(s))}))),o.push(l.editor.onDidCreateEditor((e=>{o.push(l.editor.onDidCreateModel((()=>{const r=we(t);e.getAction(r.id)||o.push(e.addAction(r))})))}))),o.push(l.editor.onDidCreateEditor((e=>{o.push(e.onDidDispose((()=>{o.forEach((e=>e.dispose())),o.length=0})))}))),globalThis.MonacoEnvironment={...globalThis.MonacoEnvironment,getWorkerUrl(e,t){return t===h?new URL("./apidom.worker.js",this.baseUrl).toString():new URL("./editor.worker.js",this.baseUrl).toString()}}},Ie=({createData:e={}}={})=>t=>{(()=>{const e=p.ModesRegistry.getLanguages().map((({id:e})=>e));return e.includes(h)})()||(je({createData:e,system:t}),t.editorActions.setLanguage(Se.getLanguageId()))},Le=({jsonPointer:e})=>({type:"editor_monaco_language_apidom_get_json_pointer_position_started",payload:e}),_e=({position:e,jsonPointer:t})=>({type:"editor_monaco_language_apidom_get_json_pointer_position_success",payload:e,meta:{jsonPointer:t}}),Ae=({error:e,jsonPointer:t})=>({type:"editor_monaco_language_apidom_get_json_pointer_position_failure",error:!0,payload:e,meta:{jsonPointer:t}}),Me=e=>async t=>{const{editorActions:o,editorSelectors:r,fn:n}=t;o.getJsonPointerPositionStarted({jsonPointer:e});try{const t=r.selectEditor().getModel(),i=await n.getApiDOMWorker()(t.uri),{line:s,character:a}=await i.getJsonPointerPosition(t.uri.toString(),e),c={lineNumber:s,column:a-1};return o.getJsonPointerPositionSuccess({position:c,jsonPointer:e})}catch(i){return o.getJsonPointerPositionFailure({error:i,jsonPointer:e})}},Te=(e={})=>{const t="function"===typeof e.getSystem,o=t?{}:e,r=()=>({afterLoad:Ie(o),fn:{getApiDOMWorker:fe},statePlugins:{editor:{actions:{getJsonPointerPosition:Me,getJsonPointerPositionStarted:Le,getJsonPointerPositionSuccess:_e,getJsonPointerPositionFailure:Ae}}}});return t?r():r};var xe=a.Z;export{xe as default};
//# sourceMappingURL=index.js.map