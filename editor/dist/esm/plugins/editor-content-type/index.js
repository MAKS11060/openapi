import*as e from"short-unique-id";import*as t from"@swagger-api/apidom-parser-adapter-asyncapi-json-2";import*as n from"@swagger-api/apidom-parser-adapter-asyncapi-yaml-2";import*as o from"@swagger-api/apidom-parser-adapter-openapi-json-2";import*as r from"@swagger-api/apidom-parser-adapter-openapi-yaml-2";import*as s from"@swagger-api/apidom-parser-adapter-openapi-json-3-0";import*as c from"@swagger-api/apidom-parser-adapter-openapi-yaml-3-0";import*as a from"@swagger-api/apidom-parser-adapter-openapi-json-3-1";import*as i from"@swagger-api/apidom-parser-adapter-openapi-yaml-3-1";import*as p from"@swagger-api/apidom-parser-adapter-api-design-systems-json";import*as d from"@swagger-api/apidom-parser-adapter-api-design-systems-yaml";import*as l from"reselect";import*as u from"js-yaml";var y={d:(e,t)=>{for(var n in t)y.o(t,n)&&!y.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},v={};y.d(v,{Z:()=>se});const m=(e=>{var t={};return y.d(t,e),t})({default:()=>e.default});const g=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>t.detectionRegExp});const T=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>n.detectionRegExp});const S=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>o.detectionRegExp});const I=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>r.detectionRegExp});const j=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>s.detectionRegExp});const f=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>c.detectionRegExp});const x=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>a.detectionRegExp});const C=(e=>{var t={};return y.d(t,e),t})({detectionRegExp:()=>i.detectionRegExp});const E=(e=>{var t={};return y.d(t,e),t})({detect:()=>p.detect,detectionRegExp:()=>p.detectionRegExp});const O=(e=>{var t={};return y.d(t,e),t})({detect:()=>d.detect,detectionRegExp:()=>d.detectionRegExp}),R="editor_content_type_detect_started",_="editor_content_type_detect_success",q="editor_content_type_detect_failure",h=({content:e,requestId:t})=>({type:R,payload:e,meta:{requestId:t}}),A=({contentType:e,content:t,requestId:n})=>({type:_,payload:e,meta:{content:t,requestId:n}}),b=({error:e,content:t,requestId:n})=>({type:q,payload:e,error:!0,meta:{content:t,requestId:n}}),$=e=>{const t=new m.default({length:10});return async n=>{const{editorActions:o,fn:r}=n,s=t();o.detectContentTypeStarted({content:e,requestId:s});try{const t=e.match(g.detectionRegExp);if(null!==t&&r.isValidJSONObject(e)){const{groups:n}=t,r=`application/vnd.aai.asyncapi+json;version=${null===n||void 0===n?void 0:n.version_json}`;return o.detectContentTypeSuccess({contentType:r,content:e,requestId:s})}const n=e.match(T.detectionRegExp);if(null!==n&&r.isValidYAMLObject(e)){var c;const{groups:t}=n,r=`application/vnd.aai.asyncapi+yaml;version=${null!==(c=null===t||void 0===t?void 0:t.version_json)&&void 0!==c?c:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:r,content:e,requestId:s})}const u=e.match(S.detectionRegExp);if(null!==u&&r.isValidJSONObject(e)){const{groups:t}=u,n=`application/vnd.oai.openapi+json;version=${null===t||void 0===t?void 0:t.version_json}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const y=e.match(I.detectionRegExp);if(null!==y&&r.isValidYAMLObject(e)){var a;const{groups:t}=y,n=`application/vnd.oai.openapi+yaml;version=${null!==(a=null===t||void 0===t?void 0:t.version_json)&&void 0!==a?a:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const v=e.match(/"asyncapi"\s*:\s*"(?<version_json>3\.(?:[1-9]\d*|0)\.(?:[1-9]\d*|0))"/);if(null!==v&&r.isValidJSONObject(e)){const{groups:t}=v,n=`application/vnd.aai.asyncapi+json;version=${null===t||void 0===t?void 0:t.version_json}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const m=e.match(/(?<YAML>^(["']?)asyncapi\2\s*:\s*(["']?)(?<version_yaml>3\.(?:[1-9]\d*|0)\.(?:[1-9]\d*|0))\3(?:\s+|$))|(?<JSON>"asyncapi"\s*:\s*"(?<version_json>3\.(?:[1-9]\d*|0)\.(?:[1-9]\d*|0))")/m);if(null!==m&&r.isValidYAMLObject(e)){var i;const{groups:t}=m,n=`application/vnd.aai.asyncapi+yaml;version=${null!==(i=null===t||void 0===t?void 0:t.version_json)&&void 0!==i?i:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const R=e.match(j.detectionRegExp);if(null!==R&&r.isValidJSONObject(e)){const{groups:t}=R,n=`application/vnd.oai.openapi+json;version=${null===t||void 0===t?void 0:t.version_json}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const _=e.match(f.detectionRegExp);if(null!==_&&r.isValidYAMLObject(e)){var p;const{groups:t}=_,n=`application/vnd.oai.openapi+yaml;version=${null!==(p=null===t||void 0===t?void 0:t.version_json)&&void 0!==p?p:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const q=e.match(x.detectionRegExp);if(null!==q&&r.isValidJSONObject(e)){const{groups:t}=q,n=`application/vnd.oai.openapi+json;version=${null===t||void 0===t?void 0:t.version_json}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const h=e.match(C.detectionRegExp);if(null!==h&&r.isValidYAMLObject(e)){var d;const{groups:t}=h,n=`application/vnd.oai.openapi+yaml;version=${null!==(d=null===t||void 0===t?void 0:t.version_json)&&void 0!==d?d:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const A=e.match(E.detectionRegExp);if(null!==A&&await(0,E.detect)(e)){const{groups:t}=A,n=`application/vnd.aai.apidesignsystems+json;version=${null===t||void 0===t?void 0:t.version_json}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}const b=e.match(O.detectionRegExp);if(null!==b&&await(0,O.detect)(e)){var l;const{groups:t}=b,n=`application/vnd.aai.apidesignsystems+yaml;version=${null!==(l=null===t||void 0===t?void 0:t.version_json)&&void 0!==l?l:null===t||void 0===t?void 0:t.version_yaml}`;return o.detectContentTypeSuccess({contentType:n,content:e,requestId:s})}if(r.isValidJSON(e)){const t="application/json";return o.detectContentTypeSuccess({contentType:t,content:e,requestId:s})}if(r.isValidYAML(e)){const t="text/yaml";return o.detectContentTypeSuccess({contentType:t,content:e,requestId:s})}return o.detectContentTypeFailure({error:new Error("No content type detected"),content:e,requestId:s})}catch(u){return o.detectContentTypeFailure({error:u,content:e,requestId:s})}}},w=(e=>{let t=null;return(n,o)=>(...r)=>{const s=n(...r);return s===t||(e(n,o)(...r),t=s),s}})(((e,t)=>e=>{const{editorActions:n}=t;n.detectContentType(e,t)}));const V=(e=>{var t={};return y.d(t,e),t})({createSelector:()=>l.createSelector}),N="idle",D="detecting",J=null,F={[R]:(e,t)=>e.merge({contentTypeDetectionStatus:D,contentTypeDetectionRequestId:t.meta.requestId}),[_]:(e,t)=>{const n=e.get("contentTypeDetectionStatus")||N,o=e.get("contentTypeDetectionRequestId");return n===D&&o===t.meta.requestId?e.merge({contentTypeDetectionStatus:"success",contentTypeDetectionRequestId:null,contentType:t.payload,contentTypeError:null}):e},[q]:(e,t)=>{const n=e.get("contentTypeDetectionStatus")||N,o=e.get("contentTypeDetectionRequestId");return n===D&&o===t.meta.requestId?e.merge({contentTypeDetectionStatus:"failure",contentTypeDetectionRequestId:null,contentType:null,contentTypeError:t.payload.message}):e}},P=e=>e.get("contentTypeDetectionStatus"),L=(0,V.createSelector)(P,(e=>e===D)),M=e=>e.get("contentType")||J,Y=(0,V.createSelector)(M,(e=>null!==e&&e.startsWith("application/vnd.oai.openapi"))),W=(0,V.createSelector)(Y,M,((e,t)=>e&&/version=2\.0$/.test(t))),Z=(0,V.createSelector)(Y,M,((e,t)=>e&&/version=3\.0\.\d+$/.test(t))),k=(0,V.createSelector)(Y,M,((e,t)=>e&&/version=3\.1\.\d+$/.test(t))),z=(0,V.createSelector)(M,(e=>null!==e&&e.startsWith("application/vnd.aai.asyncapi"))),B=(0,V.createSelector)(z,M,((e,t)=>e&&/version=2.\d+\.\d+$/.test(t))),G=(0,V.createSelector)(M,(e=>null!==e&&e.startsWith("application/vnd.aai.apidesignsystems"))),H=(0,V.createSelector)(M,(e=>null!==e&&("application/json"===e||e.includes("+json")))),K=(0,V.createSelector)(M,(e=>null!==e&&("text/yaml"===e||e.includes("+yaml")))),Q=(0,V.createSelector)(H,K,((e,t)=>e?".json":t?".yaml":".txt")),U=(0,V.createSelector)(W,Z,k,B,((e,t,n,o)=>e?"openapi2":t?"openapi3_0":n?"openapi3_1":o?"asyncapi2":"definition")),X=(0,V.createSelector)(Q,U,((e,t)=>`${t}${e}`));const ee=(e=>{var t={};return y.d(t,e),t})({default:()=>u.default}),te=e=>{try{return JSON.parse(e)&&!0}catch{return!1}},ne=e=>{try{const t=JSON.parse(e);return"[object Object]"===Object.prototype.toString.call(t)}catch{return!1}},oe=e=>{try{return ee.default.load(e)&&!0}catch{return!1}},re=e=>{try{const t=ee.default.load(e);return"[object Object]"===Object.prototype.toString.call(t)}catch{return!1}},se=()=>({statePlugins:{editor:{wrapActions:{setContent:w},actions:{detectContentType:$,detectContentTypeStarted:h,detectContentTypeSuccess:A,detectContentTypeFailure:b},selectors:{selectIsContentFormatYAML:K,selectIsContentFormatJSON:H,selectContentType:M,selectContentTypeDetectionStatus:P,selectIsContentTypeDetectionInProgress:L,selectIsContentTypeAsyncAPI:z,selectIsContentTypeAsyncAPI2:B,selectIsContentTypeOpenAPI:Y,selectIsContentTypeOpenAPI20:W,selectIsContentTypeOpenAPI30x:Z,selectIsContentTypeOpenAPI31x:k,selectIsContentTypeAPIDesignSystems:G,selectInferFileExtensionFromContent:Q,selectInferFileNameFromContent:U,selectInferFileNameWithExtensionFromContent:X},reducers:F}},fn:{isValidJSON:te,isValidJSONObject:ne,isValidYAML:oe,isValidYAMLObject:re}});var ce=v.Z;export{ce as default};
//# sourceMappingURL=index.js.map